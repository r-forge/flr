{
    "contents" : "% diags.Rnw --\n%\n% Author: laurence kell <lauriekell@gmail.com>\n\n%\\VignetteIndexEntry{diags}\n%\\VignetteIndexEntry{An R Package for read/wrting CPUE files and plotting data from a variety of fish stock assessment programs}\n%\\VignetteKeyword{CPUE, diagnostics, IO, read, write}\n\n\n\\documentclass[shortnames,nojss,article]{jss}\n\n\\usepackage[onehalfspacing]{setspace}\n\\usepackage{color}\n\\usepackage{natbib} \\bibliographystyle{plain}\n\\usepackage{graphicx, psfrag, Sweave}\n\\usepackage{enumerate}\n\n\\usepackage{booktabs,flafter} %,thumbpdf}\n\\usepackage{hyperref}\n\n%\\usepackage[margin=0.5in]{geometry}\n\n\\usepackage{listings}\n\n\\newenvironment{mylisting}\n{\\begin{list}{}{\\setlength{\\leftmargin}{1em}}\\item\\scriptsize\\bfseries}\n{\\end{list}}\n\n\\newenvironment{mytinylisting}\n{\\begin{list}{}{\\setlength{\\leftmargin}{1em}}\\item\\tiny\\bfseries}\n{\\end{list}}\n\n\\usepackage{listings}\n\n\n%\\definecolor{darkblue}{  rgb}{0,0,0.50}\n%\\definecolor{shadecolor}{rgb}{1,1,0.95}\n%\\definecolor{shade}{     rgb}{1,1,0.95}\n\n\n\\lstset{\nlanguage=R,                     % the language of the code\nbasicstyle=\\footnotesize,       % the size of the fonts that are used for the code\nnumbers=left,                   % where to put the line-numbers\nnumberstyle=\\footnotesize,      % the size of the fonts that are used for the line-numbers\nstepnumber=100,                 % the step between two line-numbers. If it's 1, each line \n                                % will be numbered\nnumbersep=5pt,                  % how far the line-numbers are from the code\nbackgroundcolor=\\color{shade},  % choose the background color. You must add \\usepackage{color}\nshowspaces=false,               % show spaces adding particular underscores\nshowstringspaces=false,         % underline spaces within strings\nshowtabs=false,                 % show tabs within strings adding particular underscores\nframe=single,                   % adds a frame around the code\ntabsize=2,                      % sets default tabsize to 2 spaces\ncaptionpos=b,                   % sets the caption-position to bottom\nbreaklines=true,                % sets automatic line breaking\nbreakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace\ntitle=\\lstname,                 % show the filename of files included with \\lstinputlisting;\n                                % also try caption instead of title\nescapeinside={\\%*}{*)},         % if you want to add a comment within your code\nmorekeywords={*,...}            % if you want to add more keywords to the set\n}\n\n%\\newcommand{\\code}[1]{\\texttt{#1}}\n%\\newcommand{\\proglang}[1]{\\textsf{#1}}\n%\\newcommand{\\pkg}[1]{{\\fontseries{b}\\selectfont #1}}\n\n\\author{Laurence Kell\\\\ICCAT}\n\\Plainauthor{Laurence Kell}\n\n\n\\title{A Preliminary Stock Assessment of North Atlantic Swordfish using an Aged Based State Space Model}\n\\Plaintitle{A Preliminary Stock Assessment of North Atlantic Swordfish using an Aged Based State Space Model}\n\n\\Abstract{In this document we compare the results from the 2009 Swordfish VPA assessment with a\n          State-space fish stock assessment model}\n\n\\Keywords{\\proglang{R}, swordfish, North Atlantic, State Space, VPA}\n\\Plainkeywords{R, swordfish, North Atlantic, State Space, VPA}\n\n\n\\Address{\n  Laurence Kell \\\\\n  ICCAT Secretariat\\\\ \n  C/Coraz\\'{o}n de Mar\\'{\\i}a, 8. \\\\\n  28002 Madrid\\\\\n  Spain\\\\ \n  \n  E-mail: \\email{Laurie.Kell@iccat.int}}\n\n%% need no \\usepackage{Sweave.sty}\n\n\n\n<<prelim,echo=FALSE,print=FALSE>>=\nlibrary(kobe)\nlibrary(cpue)\nlibrary(FLash)\nlibrary(FLAdvice)\nlibrary(FLAdapt)\nlibrary(ggplotFL)\n\nstampIt=function(...){\n   require(plyr)\n\n   args=list(...)\n   \n   ldply(args, function(x) { res=packageDescription(x)\n                            c(Package=x,\n                              Version=packageDescription(\"cpue\")$Version,\n                              Date   =packageDescription(\"cpue\")$Date)})}\n\nsmry=stampIt(\"kobe\",\"cpue\",\"FLash\",\"FLAdvice\",\"FLAdapt\")\n\ntheme_ms <- function(base_size = 12, base_family = \"\",...) { \n  # Starts with theme_grey and then modify some parts \n  res=theme_grey(base_size = base_size, base_family   = base_family) %+replace% \n    theme(axis.text         = element_text(                                     size   = rel(0.8)), \n          axis.ticks        = element_line(                 colour = \"black\"), \n          legend.key        = element_rect(                 colour = \"grey80\"), \n          panel.background  = element_rect(fill = \"white\",  colour = NA), \n          panel.border      = element_rect(fill = NA,       colour = \"grey50\"), \n          panel.grid.major  = element_line(                 colour = \"grey90\",  size = 0.2), \n          panel.grid.minor  = element_line(                 colour = \"grey98\",  size = 0.5), \n          strip.background  = element_rect(fill = \"grey80\", colour = \"grey50\"), \n          strip.background  = element_rect(fill = \"grey80\", colour = \"grey50\")) \n  \n  modifyList(res, list(...))\n} \n@\n\n\\begin{document}\n\\SweaveOpts{concordance=TRUE,width=7,height=5}\n\n  \n\\section{Data}\n\n<<data,echo=TRUE,print=FALSE>>=\nfileVpa    =\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/SAM/inputs/unisex09.c01\"\nfileDiagVpa=\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/SAM/inputs/unisex09.r01\"\nfileLow    =\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/SAM/samFiles/swonIndex.txt\"\ndirSam     =\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/SAM/swon/run/sam\"\nfileIdx    =\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/SAM/swon/data/survey.dat\"\n@\n\n\n\\section{CPUE}\n\n<<cpue1,echo=TRUE,print=FALSE>>=\ncpue   =readU(fileIdx,\"vpa\")\n\nhead(cpue)\n\ncpueNms=unique(cpue$name)\n@\n\n<<label=cpueFig1,fig=TRUE, echo=TRUE, include=FALSE>>=\nggplot(aes(year,index),data=ddply(cpue, .(name,age), transform, index=minMax(index,na.rm=T))) +\n  geom_point()                    +\n  stat_smooth(,method=\"lm\",se=F)  +\n  facet_grid(age~name)           \n@ \n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueFig1}\\caption{An example plot.}\\end{figure}\n\n\n<<cpueFig2,fig=TRUE,echo=TRUE,include=FALSE>>=\nlibrary(ellipse)\nlibrary(corrplot)\n\ncpue$yrcls=cpue$year-cpue$age\ncpue=cast(cpue,yrcls~name+age,value=\"index\")\n\ncr=cor(cpue[,-1],use=\"pairwise.complete.obs\",method=\"spearman\")\ndimnames(cr)=list(gsub(\"_\",\" \",names(cpue)[-1]),gsub(\"_\",\" \",names(cpue)[-1]))\ncorrplot(cr,diag=F,order=\"hclust\",addrect=4)\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueFig2}\\caption{An example plot.}\\end{figure}\n\n\\subsection{Residual Diagnostics}\n\n\\clearpage\n<<data,echo=TRUE,print=FALSE>>=\nrsdlSAM=transform(cbind(Method=\"SAM\",subset(diagU(dirSam,\"sam\"),name!=1)),        \n                  name=cpueNms[name-1])\nrsdlVPA=transform(cbind(Method=\"VPA\",diagU(fileDiagVpa,\"2box\")), \n                  name=str_trim(as.character(name)))\nrsdlVPA=transform(rsdlVPA, \n                  age  =substr(rsdlVPA$name,8,8),\n                  name =gsub(\" \", \"\", substr(name,4,6)))\nrsdl   =rbind.fill(rsdlSAM,rsdlVPA)\n@\n\n\n\\clearpage\n<<cpueDiagFig1,fig=TRUE,echo=TRUE,include=FALSE>>=\nggplot(rsdl) + \n       geom_point(aes(year,age,size=    pmax(residual,0) ^.5),col=\"black\") +\n       geom_point(aes(year,age,size=(-1*pmin(residual,0))^.5),col=\"red\")   +\n       scale_area(range=c(0,5))                                            +\n       facet_grid(name~Method)                                             +\n       scale_y_continuous(limits=c(0,6))                                   +\n       theme(legend.position=\"none\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig1}\\caption{An example plot.}\\end{figure}\n\n\n\\clearpage\n<<cpueDiagFig2,fig=TRUE,echo=TRUE,include=FALSE>>=\nrsdl.=ddply(rsdl, .(Method,name,age), with, data.frame(index.=stdz(index),hat.=stdz(hat)))\n\n ggplot(aes(colour=Method,group=Method),data=rsdl.)+\n          geom_point( aes(index.,hat.))                   +\n          stat_smooth(aes(index.,hat.),method=\"lm\",se=F)  +\n          facet_grid(name~age)                            +              \n          theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig2}\\caption{An example plot.}\\end{figure}\n\n\n\\clearpage\n<<cpueDiagFig3,fig=TRUE,echo=TRUE, include=FALSE>>=\nggplot(aes(colour=Method,group=Method),data=rsdl)  +\n  geom_point( aes(qqx,qqy))                             +\n  stat_smooth(aes(qqx,qqHat),method=\"lm\",se=F)          +\n  facet_grid(name~age)                                  +\n  theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig3}\\caption{An example plot.}\\end{figure}\n\n\n\\clearpage\n<<cpueDiagFig4,fig=TRUE,echo=TRUE,include=FALSE>>=\nggplot(aes(colour=Method,group=Method),data=rsdl)     +\n  geom_point( aes(residualLag,residual))                   +\n  stat_smooth(aes(residualLag,residual),method=\"lm\",se=F)  +\n  facet_grid(name~age)                                     +\n  theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig4}\\caption{An example plot.}\\end{figure}\n\n\n\\clearpage\n<<cpueDiagFig5,fig=TRUE,echo=TRUE,include=FALSE>>=\nggplot(aes(colour=Method,group=Method),data=rsdl) +\n  geom_point( aes(year,residual))                      +\n  stat_smooth(aes(year,residual),method=\"lm\",se=F)     +\n  facet_grid(name~age)                                 +\n  theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig5}\\caption{An example plot.}\\end{figure}\n\n\n\\clearpage\n<<cpueDiagFig6,fig=TRUE,echo=TRUE, width=6, include=FALSE>>=\nggplot(aes(colour=Method,group=Method),data=rsdl) +\n  geom_point( aes(hat,residual))                       +\n  stat_smooth(aes(hat,residual),method=\"lm\",se=F)      +\n  facet_grid(name~age)                                 +\n  theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig6}\\caption{An example plot.}\\end{figure}\n\n\n<<cpueDiagFig7,fig=TRUE,echo=TRUE, include=FALSE>>=\nggplot(aes(colour=Method,group=Method),data=rsdl) +\n  geom_point( aes(year,hat))                           +\n  stat_smooth(aes(year,index),method=\"lm\",se=F)        +\n  facet_grid(name~age)                                 +\n  theme_ms(legend.position=\"bottom\")\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig7}\\caption{An example plot.}\\end{figure}\n\n\\section{Historic Stock Estimates}\n\n\\subsection{Time Series}\n\n\\subsection{Stock Recruitment Relationships}\n\n\\subsection{Reference Points}\n\n<<histSR1,fig=TRUE,echo=TRUE,include=FALSE>>=\nvpa=readVpa2box(fileVpa)\nsam=samNF(vpa[,,,,,1],dirSam)\nsam@catch=computeCatch(sam)\n\nmmm=plot(FLStocks(SAM=sam,VPA=vpa))\n\nsamSR=fmle(as.FLSR(iter(sam,1),model=\"geomean\"))\nvpaSR=fmle(as.FLSR(iter(vpa,1),model=\"bevholt\"))\n@\n\n<<samSR,fig=TRUE,echo=TRUE,include=FALSE>>=\nplot(samSR)\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-samSR}\\caption{An example plot.}\\end{figure}\n\n<<vpaSR,fig=TRUE,echo=TRUE,include=FALSE>>=\nplot(vpaSR)\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-vpaSR}\\caption{An example plot.}\\end{figure}\n\n<<SRs,fig=TRUE,echo=TRUE,include=TRUE>>=\nlibrary(kobe)\nlibrary(ggplotFL)\nload(\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/data/swo.Rdata\")\n#dgs=ggplot(aes(group=Method,colour=Method), data=rbind(cbind(Method=\"VPA\",diags(samSR)),\n#                                                       cbind(Method=\"SAM\",diags(vpaSR))))\n   \n# b=dgs+geom_line( aes(ssb,rec)) +\n#      geom_point(aes(x,y)) +\n#      theme_ms()\n  \n# c=dgs+geom_point( aes(ssb,residual)) +\n#      geom_smooth(aes(ssb,residual)) +\n#      geom_hline((aes(yintercept=0)))\n \n# multiplot(b,c)\n@\n\n<<kobe,fig=TRUE,echo=TRUE,include=TRUE>>=\nsamBrp=brp(FLBRP(iter(sam,1),sr=samSR))\nvpaBrp=brp(FLBRP(iter(vpa,1),sr=vpaSR))\n\nsave(sam,vpa,samBrp,vpaBrp,samSR,vpaSR,file=\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/data/swo.Rdata\")\n\nplot(samBrp)\n@\n\n<<brpVpa,fig=TRUE,echo=TRUE,include=FALSE>>=\nplot(vpaBrp)\n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-vpaBrp}\\caption{An example plot.}\\end{figure}\n\n\n\\section{Management Advice}\n\n\n<<kobe,echo=TRUE,include=FALSE>>=\nlibrary(FLash)\nlibrary(FLAdvice)\nlibrary(plyr)\nload(\"/home/laurie/Desktop/ICCAT/SCRS/2013/SWO/data/swo.Rdata\")\n\nvpaPrj=fwdWindow(vpa,vpaBrp,end=2020)\n\nctc=FLQuants(mlply(seq(0,10)*2e6, function(x) FLQuant(x,dimnames=list(year=2008:2020))))\nnames(ctc)[]=\"catch\"\n\nsrRsdl=rlnorm(501,FLQuant(0,dimnames=list(age=1,year=2008:2020)),0.3)\n\nvpaPrj=fwd(vpaPrj,ctc,sr=vpaBrp,sr.residuals=srRsdl)\n\nobject=brp(FLBRP(vpaPrj[[1]],sr=vpaSR))\n\nkb=ldply(vpaPrj, function(x)  kobe(brp(FLBRP(x,sr=vpaSR))))\n\nkb.=ddply(kb,.(X1,year), kobeSmry)\n\nkobe2012=transform(subset(kb,year>=2008),TAC=(seq(0,10)*2e3)[X1])\n\npdat=subset(ddply(kobe2012,.(year,TAC),kobeSmry),select=c(year,TAC,green,underFished,underFishing))\npdat=melt(pdat,id.vars=c(\"year\",\"TAC\"))\npdat=ddply(pdat, .(variable), function(x) kobeInterp(data.frame(x$year,x$TAC,x$value)))\n\ncol.=c(colorRampPalette(c(\"red4\",\"red\"))(12),colorRampPalette(c(\"yellowgreen\",\"darkgreen\"))(8))\n@\n\n<<kobe,fig=TRUE,echo=TRUE,include=FALSE,include=FALSE>>=\nggplot(aes(x=x,y=y,z=w),data=pdat)                        +\n  geom_tile(aes(x,y,fill=z))                         +\n  scale_fill_manual(values=col.,guide=\"none\")   +\n  stat_contour(aes(colour = ..level..),size=1.2,  breaks=c(0.6,0.7,0.8,0.9))     +\n  scale_colour_gradient(low=\"grey\", high=\"black\", breaks=c(0.6,0.7,0.8,0.9),labels=c(0.6,0.7,0.8,0.9),limits=c(0.6,1))    +\n  facet_wrap(~variable,ncol=1)                       +\n  xlab(\"Year\")+ylab(\"TAC\") \n@\n\\begin{figure}[h]\\centering\\includegraphics[width=1.0\\textwidth]\n{swo2013Sam-cpueDiagFig7}\\caption{An example plot.}\\end{figure}\n\n\n\n\\end{document}\n",
    "created" : 1354810545165.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3999730317",
    "id" : "6F65171E",
    "lastKnownWriteTime" : 1354517008,
    "path" : "~/Desktop/ICCAT/SCRS/2013/SWO/tex/swo2013Sam.Rnw",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "sweave"
}